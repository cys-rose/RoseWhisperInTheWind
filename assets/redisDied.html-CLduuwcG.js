import{_ as i,c as s,b as d,o as l}from"./app-CAxpB9_7.js";const t="/RoseWhisperInTheWind/assets/Redis%E5%86%85%E5%AD%98%E7%94%A8%E5%9C%A8%E5%93%AA-A7RVdbPU.png",a={};function r(n,e){return l(),s("div",null,e[0]||(e[0]=[d('<h1 id="redis-在什么情况下会宕机" tabindex="-1"><a class="header-anchor" href="#redis-在什么情况下会宕机"><span>Redis 在什么情况下会宕机？</span></a></h1><p>之前我一直认为 Redis 宕机肯定就是因为 Redis 的使用内存占用超过了你配置的大小，要不就是什么物理因素，直到我偶然读了一篇微信公众号推文，才打开了新眼界，对 Redis 也有了新的认识。</p><h2 id="redis-内存都用在哪了" tabindex="-1"><a class="header-anchor" href="#redis-内存都用在哪了"><span>Redis 内存都用在哪了？</span></a></h2><p>以下是 Redis 内存总消耗的划分，其中的缓冲区和内存碎片确实让我扩展了眼界 <img src="'+t+'" alt="Redis 内存都用在哪了" loading="lazy"></p><ol><li>Redis 缓冲区</li></ol><ul><li>输入缓冲区：用于暂存客户端发到 Redis 服务器的命令请求，也就是说客户端的命令首先会被保存在这里。</li><li>输出缓冲区：用于暂存 Redis 要返回给客户端的数据。</li><li>复制缓冲区：用于主从复制时，主服务器把写命令先写入复制缓冲区中，然后将这些写命令发送给从服务器。</li><li>AOF 缓冲区：当进行开启 AOF 持久化时，每执行一条会更改 Redis 中数据的命令时，就会先将该命令写入 AOF 缓冲区，然后会调用操作系统的<code>write</code>函数，将 AOF 缓冲区的内容写入到系统内核缓冲区中，然后再由持久化方式（ fsync 策略）同步到磁盘。</li></ul><ol start="2"><li>Redis 内存碎片 这里说的内存碎片和操作系统的内存碎片概念上我认为是一致的。那么如何产生呢？ <ol><li>内存分配策略 <ul><li>固定内存大小分配：如 Redis 的 jemalloc 内存分配器会按照一系列固定大小分配内存</li><li>预分配内存机制：Redis 存储数据的时候向操作系统申请的内存空间可能会大于数据实际需要的存储空间。</li></ul></li><li>数据的频繁修改和删除 <ul><li>修改数据：将原有的数据修改变小时，会产生碎片</li><li>数据删除：当删除一个键值对时，Redis 只是将这个键值对所占用的内存标记为可复用，但这片内存空间可能与其他已分配的内存空间不连续。</li></ul></li></ol></li></ol><h2 id="内存使用率达到-100-等于-redis-不可用吗" tabindex="-1"><a class="header-anchor" href="#内存使用率达到-100-等于-redis-不可用吗"><span>内存使用率达到 100%等于 Redis 不可用吗？</span></a></h2><p>其实是不一定的，因为如果是 Redis 的存储对象的内存达到了<code>maxmemory</code>时，会触发淘汰策略，来保障 Redis 的可用性。但如果是 Redis 的缓冲区占用太多就不一定了，因为可能是 Redis 数据存储区域还没到<code>maxmemory</code>，可缓冲区已经占用太多了，导致内存使用率达到 100%，就会导致 Redis 不可用。</p><h2 id="什么原因导致缓冲区占用太多内存" tabindex="-1"><a class="header-anchor" href="#什么原因导致缓冲区占用太多内存"><span>什么原因导致缓冲区占用太多内存？</span></a></h2><ol><li>输入缓冲区： <ul><li>客户端命令发送过快且命令体过大</li><li>当客户端和 Redis 服务器之间的网络出现波动或者带宽限制时，命令的传输速度会受到影响。比如，客户端在一个网络质量较差的环境下，不断地向 Redis 发送命令，这些命令不能及时被 Redis 接收处理，就会在网络缓存中积压，当网络恢复正常时，大量积压的命令会一下子涌入 Redis 的输入缓冲区，导致内存占用过多。</li></ul></li><li>输出缓冲区： <ul><li>返回结果集过大：当执行一些范围查询或者获取大量数据的操作时，Redis 会将结果放入输出缓冲区等待发送给客户端。</li><li>客户端接收速度过慢</li></ul></li></ol><h2 id="本质原因是什么" tabindex="-1"><a class="header-anchor" href="#本质原因是什么"><span>本质原因是什么？</span></a></h2><p>导致缓冲区占用太多内存主要应该归因为大 key 问题。我们在设计中要避免大 key，对大 key 做好拆分。</p>',13)]))}const c=i(a,[["render",r],["__file","redisDied.html.vue"]]),p=JSON.parse('{"path":"/backend/redis/redisDied.html","title":"Redis 在什么情况下会宕机？","lang":"zh-CN","frontmatter":{"description":"Redis 在什么情况下会宕机？ 之前我一直认为 Redis 宕机肯定就是因为 Redis 的使用内存占用超过了你配置的大小，要不就是什么物理因素，直到我偶然读了一篇微信公众号推文，才打开了新眼界，对 Redis 也有了新的认识。 Redis 内存都用在哪了？ 以下是 Redis 内存总消耗的划分，其中的缓冲区和内存碎片确实让我扩展了眼界 Redis ...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/RoseWhisperInTheWind/backend/redis/redisDied.html"}],["meta",{"property":"og:site_name","content":"风中玫瑰的低语"}],["meta",{"property":"og:title","content":"Redis 在什么情况下会宕机？"}],["meta",{"property":"og:description","content":"Redis 在什么情况下会宕机？ 之前我一直认为 Redis 宕机肯定就是因为 Redis 的使用内存占用超过了你配置的大小，要不就是什么物理因素，直到我偶然读了一篇微信公众号推文，才打开了新眼界，对 Redis 也有了新的认识。 Redis 内存都用在哪了？ 以下是 Redis 内存总消耗的划分，其中的缓冲区和内存碎片确实让我扩展了眼界 Redis ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-11T13:55:34.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-11T13:55:34.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis 在什么情况下会宕机？\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-01-11T13:55:34.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Rose\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"Redis 内存都用在哪了？","slug":"redis-内存都用在哪了","link":"#redis-内存都用在哪了","children":[]},{"level":2,"title":"内存使用率达到 100%等于 Redis 不可用吗？","slug":"内存使用率达到-100-等于-redis-不可用吗","link":"#内存使用率达到-100-等于-redis-不可用吗","children":[]},{"level":2,"title":"什么原因导致缓冲区占用太多内存？","slug":"什么原因导致缓冲区占用太多内存","link":"#什么原因导致缓冲区占用太多内存","children":[]},{"level":2,"title":"本质原因是什么？","slug":"本质原因是什么","link":"#本质原因是什么","children":[]}],"git":{"createdTime":1736603734000,"updatedTime":1736603734000,"contributors":[{"name":"Rose","email":"2677596161@qq.com","commits":1}]},"readingTime":{"minutes":3.14,"words":942},"filePathRelative":"backend/redis/redisDied.md","localizedDate":"2025年1月11日","excerpt":"\\n<p>之前我一直认为 Redis 宕机肯定就是因为 Redis 的使用内存占用超过了你配置的大小，要不就是什么物理因素，直到我偶然读了一篇微信公众号推文，才打开了新眼界，对 Redis 也有了新的认识。</p>\\n<h2>Redis 内存都用在哪了？</h2>\\n<p>以下是 Redis 内存总消耗的划分，其中的缓冲区和内存碎片确实让我扩展了眼界\\n</p>\\n<ol>\\n<li>Redis 缓冲区</li>\\n</ol>\\n<ul>\\n<li>输入缓冲区：用于暂存客户端发到 Redis 服务器的命令请求，也就是说客户端的命令首先会被保存在这里。</li>\\n<li>输出缓冲区：用于暂存 Redis 要返回给客户端的数据。</li>\\n<li>复制缓冲区：用于主从复制时，主服务器把写命令先写入复制缓冲区中，然后将这些写命令发送给从服务器。</li>\\n<li>AOF 缓冲区：当进行开启 AOF 持久化时，每执行一条会更改 Redis 中数据的命令时，就会先将该命令写入 AOF 缓冲区，然后会调用操作系统的<code>write</code>函数，将 AOF 缓冲区的内容写入到系统内核缓冲区中，然后再由持久化方式（ fsync 策略）同步到磁盘。</li>\\n</ul>","autoDesc":true}');export{c as comp,p as data};
